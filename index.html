<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–£—á—É –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å–≤–æ–∏–º –ø–æ—á–µ—Ä–∫–æ–º (0‚Äì9)</title>
  <style>
    :root { font-family: -apple-system, system-ui, Arial; }
    body { margin:0; background:#0b0d12; color:#e9eefc; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    h1 { margin: 10px 0 6px; font-size: 22px; }
    .sub { margin: 0 0 12px; opacity:.8; line-height:1.35; }
    .card { background:#111626; border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:10px 0; }
    button { border:0; border-radius:12px; padding:12px 14px; font-weight:800; background:#2a6bff; color:#fff; }
    button.ghost { background:transparent; border:1px solid rgba(255,255,255,.18); }
    button.small { padding:10px 12px; font-weight:900; }
    button:disabled { opacity:.4; }
    .canvasWrap { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-start; }
    canvas { background:#000; border-radius:14px; border:1px solid rgba(255,255,255,.12); touch-action:none; }
    .panel { min-width: 280px; flex: 1; }
    .big { font-size: 56px; font-weight: 950; margin: 6px 0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 13px; opacity:.92; }
    .grid { display:grid; grid-template-columns: repeat(5, minmax(48px, 1fr)); gap:10px; }
    details { margin-top:10px; opacity:.9; }
    summary { cursor: pointer; }
    .pill { display:inline-block; padding:6px 10px; border:1px solid rgba(255,255,255,.15); border-radius:999px; }
  </style>
</head>
<body>
  <main class="wrap">
    <h1>–ù–µ–π—Ä–æ—Å–µ—Ç—å, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —É—á–∏—à—å —Å–∞–º (—Ü–∏—Ñ—Ä—ã 0‚Äì9)</h1>
    <p class="sub">
      –†–∏—Å—É–µ—à—å —Ü–∏—Ñ—Ä—É ‚Üí –∂–º—ë—à—å <b>¬´–£–≥–∞–¥–∞—Ç—å¬ª</b>. –ï—Å–ª–∏ –æ—à–∏–±–ª–∞—Å—å ‚Äî –∂–º–∏ –∫–Ω–æ–ø–∫—É <b>–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ü–∏—Ñ—Ä—ã</b> (0‚Äì9).
      –û–Ω–∞ –¥–æ–æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ —Ç–≤–æ—ë–º –ø—Ä–∏–º–µ—Ä–µ.
    </p>

    <section class="card">
      <div class="canvasWrap">
        <div>
          <canvas id="draw" width="280" height="280"></canvas>
          <div class="row">
            <button id="btnClear" class="ghost">–°—Ç–µ—Ä–µ—Ç—å</button>
            <button id="btnGuess">ü§ñ –£–≥–∞–¥–∞—Ç—å</button>
          </div>
        </div>

        <div class="panel">
          <div class="mono">–°—Ç–∞—Ç—É—Å: <b id="status">–∑–∞–≥—Ä—É–∑–∫–∞‚Ä¶</b></div>
          <div class="big" id="pred">‚Äî</div>
          <div class="mono" id="conf">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ‚Äî</div>
          <div class="mono">–¢–æ–ø-3: <span id="top3">‚Äî</span></div>

          <div class="row">
            <span class="pill mono">–ü—Ä–∏–º–µ—Ä–æ–≤: <b id="count">0</b></span>
            <span class="pill mono">–ö–ª–∞—Å—Å–æ–≤: <b id="classes">0/10</b></span>
          </div>

          <div class="mono" style="margin-top:10px;">
            –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –Ω–∞–∂–º–∏, –∫–∞–∫–∞—è —Ü–∏—Ñ—Ä–∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ:
          </div>
          <div class="grid" id="labelGrid"></div>

          <div class="row" style="margin-top:12px;">
            <button id="btnSave" class="ghost" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button id="btnLoad" class="ghost">üì¶ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <button id="btnReset" class="ghost">üß® –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
          </div>

          <details>
            <summary>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</summary>
            <ul>
              <li><b>–£–≥–∞–¥–∞—Ç—å</b> ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª—å—é.</li>
              <li><b>0‚Äì9</b> ‚Äî —Ç—ã –∑–∞–¥–∞—ë—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –∏ –º–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–∞ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ.</li>
              <li>–ß–µ–º –±–æ–ª—å—à–µ —Ç–≤–æ–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ ‚Äî —Ç–µ–º —Ç–æ—á–Ω–µ–µ –ø–æ–¥ —Ç–≤–æ—é —Ä—É–∫—É.</li>
            </ul>
          </details>

          <details>
            <summary>–°–æ–≤–µ—Ç—ã –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏</summary>
            <ul>
              <li>–†–∏—Å—É–π –ø–æ —Ü–µ–Ω—Ç—Ä—É, –ø–æ—Ç–æ–ª—â–µ, –Ω–µ —Å–ª–∏—à–∫–æ–º –º–µ–ª–∫–æ.</li>
              <li>–°–æ–±–µ—Ä–∏ –ø–æ 10‚Äì20 –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–∞–∂–¥–æ–π —Ü–∏—Ñ—Ä—ã.</li>
              <li>–ï—Å–ª–∏ –ø—É—Ç–∞–µ—Ç 1/7 ‚Äî —Ä–∏—Å—É–π ‚Äú1‚Äù –±–µ–∑ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø–∞–ª–∫–∏, –∞ ‚Äú7‚Äù —Å –ø–∞–ª–∫–æ–π.</li>
            </ul>
          </details>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>

  <script>
    // ================== helpers / UI ==================
    const $ = (id) => document.getElementById(id);
    const canvas = $('draw');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    const btnClear = $('btnClear');
    const btnGuess = $('btnGuess');
    const btnSave  = $('btnSave');
    const btnLoad  = $('btnLoad');
    const btnReset = $('btnReset');

    const statusEl = $('status');
    const predEl   = $('pred');
    const confEl   = $('conf');
    const top3El   = $('top3');
    const countEl  = $('count');
    const classesEl= $('classes');

    function setStatus(s){ statusEl.textContent = s; }
    function setOut(pred, conf, top3){
      predEl.textContent = pred;
      confEl.textContent = conf;
      top3El.textContent = top3;
    }

    // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä—è–º–æ –≤ UI (iPhone)
    window.addEventListener('error', (e) => setStatus('–û—à–∏–±–∫–∞: ' + (e.message || 'unknown')));
    window.addEventListener('unhandledrejection', (e) => setStatus('Promise error: ' + (e.reason?.message || e.reason || 'unknown')));

    // ================== drawing ==================
    function clearCanvas(){
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 22;
      setOut('‚Äî','–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ‚Äî','‚Äî');
      setStatus('—Ä–∏—Å—É–π ‚Üí —É–≥–∞–¥–∞–π ‚Üí –∏—Å–ø—Ä–∞–≤—å (0‚Äì9) –µ—Å–ª–∏ –Ω–∞–¥–æ');
    }
    clearCanvas();

    let drawing=false, lastX=0, lastY=0;
    function getPos(e){
      const r = canvas.getBoundingClientRect();
      const t = e.touches?.[0];
      const x = (t ? t.clientX : e.clientX) - r.left;
      const y = (t ? t.clientY : e.clientY) - r.top;
      return {x,y};
    }
    function startDraw(e){
      drawing = true;
      const {x,y} = getPos(e);
      lastX=x; lastY=y;
      e.preventDefault();
    }
    function moveDraw(e){
      if(!drawing) return;
      const {x,y} = getPos(e);
      ctx.beginPath();
      ctx.moveTo(lastX,lastY);
      ctx.lineTo(x,y);
      ctx.stroke();
      lastX=x; lastY=y;
      e.preventDefault();
    }
    function endDraw(){ drawing=false; }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', moveDraw);
    window.addEventListener('mouseup', endDraw);

    canvas.addEventListener('touchstart', startDraw, { passive:false });
    canvas.addEventListener('touchmove', moveDraw, { passive:false });
    canvas.addEventListener('touchend', endDraw);

    btnClear.addEventListener('click', clearCanvas);

    // ================== data storage (your examples) ==================
    // –ú—ã —Ö—Ä–∞–Ω–∏–º –ø—Ä–∏–º–µ—Ä—ã –∫–∞–∫ Uint8[784] (28*28) + label (0..9)
    let samples = []; // Array<{px: Uint8Array, y: number}>

    function stats(){
      countEl.textContent = String(samples.length);
      const set = new Set(samples.map(s => s.y));
      classesEl.textContent = `${set.size}/10`;
      btnSave.disabled = (samples.length === 0);
    }

    // base64 encode/decode Uint8Array
    function u8ToB64(u8){
      let s = '';
      for (let i=0;i<u8.length;i++) s += String.fromCharCode(u8[i]);
      return btoa(s);
    }
    function b64ToU8(b64){
      const bin = atob(b64);
      const u8 = new Uint8Array(bin.length);
      for (let i=0;i<bin.length;i++) u8[i] = bin.charCodeAt(i);
      return u8;
    }

    // ================== preprocessing (crop+center -> 28x28) ==================
    function canvasTo28x28Uint8(){
      // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Uint8Array –¥–ª–∏–Ω—ã 784 (0..255)
      return tf.tidy(() => {
        const img = tf.browser.fromPixels(canvas, 1).toFloat().div(255.0).squeeze(); // [280,280]
        const ink = img; // –±–µ–ª—ã–µ –ª–∏–Ω–∏–∏ = 1

        const mask = ink.greater(0.08).toFloat();
        const total = mask.sum().dataSync()[0];
        if (total < 1) {
          // –ø—É—Å—Ç–æ
          return new Uint8Array(28*28);
        }

        const rows = mask.sum(1);
        const cols = mask.sum(0);
        const rowsArr = rows.dataSync();
        const colsArr = cols.dataSync();
        rows.dispose(); cols.dispose();

        let ymin=0, ymax=279, xmin=0, xmax=279;
        for (let i=0;i<280;i++){ if(rowsArr[i]>0){ ymin=i; break; } }
        for (let i=279;i>=0;i--){ if(rowsArr[i]>0){ ymax=i; break; } }
        for (let i=0;i<280;i++){ if(colsArr[i]>0){ xmin=i; break; } }
        for (let i=279;i>=0;i--){ if(colsArr[i]>0){ xmax=i; break; } }

        const pad = 14;
        const y0 = Math.max(0, ymin - pad);
        const x0 = Math.max(0, xmin - pad);
        const y1 = Math.min(279, ymax + pad);
        const x1 = Math.min(279, xmax + pad);

        const h = y1 - y0 + 1;
        const w = x1 - x0 + 1;

        let cropped = ink.slice([y0,x0],[h,w]); // [h,w]

        const size = Math.max(h,w);
        const top = Math.floor((size - h)/2);
        const bottom = size - h - top;
        const left = Math.floor((size - w)/2);
        const right = size - w - left;

        cropped = tf.pad(cropped, [[top,bottom],[left,right]]);      // [size,size]
        let resized = tf.image.resizeBilinear(cropped.expandDims(-1), [28,28]); // [28,28,1]
        resized = resized.clipByValue(0,1).pow(0.7); // –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏–∫

        const u8 = new Uint8Array(28*28);
        const data = resized.squeeze().mul(255).dataSync(); // Float32 -> numbers
        for (let i=0;i<data.length;i++) u8[i] = Math.max(0, Math.min(255, Math.round(data[i])));
        return u8;
      });
    }

    function u8ToTensor(u8){
      // Uint8[784] -> tf.Tensor4D [1,28,28,1] (float 0..1)
      return tf.tidy(() => {
        const f = tf.tensor1d(Array.from(u8), 'float32').div(255.0);
        return f.reshape([1,28,28,1]);
      });
    }

    // ================== model (small CNN) ==================
    let model = null;

    function compileModel(m){
      m.compile({
        optimizer: tf.train.adam(0.001),
        loss: 'categoricalCrossentropy',
        metrics: ['accuracy'],
      });
      return m;
    }

    function buildModel(){
      const m = tf.sequential();
      m.add(tf.layers.conv2d({ inputShape:[28,28,1], filters:16, kernelSize:3, activation:'relu' }));
      m.add(tf.layers.maxPooling2d({ poolSize:2 }));
      m.add(tf.layers.conv2d({ filters:32, kernelSize:3, activation:'relu' }));
      m.add(tf.layers.maxPooling2d({ poolSize:2 }));
      m.add(tf.layers.flatten());
      m.add(tf.layers.dense({ units:64, activation:'relu' }));
      m.add(tf.layers.dropout({ rate:0.2 }));
      m.add(tf.layers.dense({ units:10, activation:'softmax' }));
      return compileModel(m);
    }

    function hasAnyTraining(){
      return samples.length >= 2; // —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤
    }

    // ================== predict ==================
    function predict(){
      try {
        setStatus('–¥—É–º–∞—é‚Ä¶');

        if(!model) { setStatus('–º–æ–¥–µ–ª—å –Ω–µ –≥–æ—Ç–æ–≤–∞'); return; }

        if(!hasAnyTraining()){
          setStatus('–º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö: –Ω–∞—Ä–∏—Å—É–π –∏ –Ω–∞–∂–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–∏—Ñ—Ä—É (0‚Äì9), —Ö–æ—Ç—è –±—ã 2‚Äì3 —Ä–∞–∑–∞');
          return;
        }

        const u8 = canvasTo28x28Uint8();
        const sum = u8.reduce((a,b)=>a+b,0);
        if (sum < 20){
          setStatus('–ø–æ—Ö–æ–∂–µ, —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª üôÇ');
          return;
        }

        const x = u8ToTensor(u8);
        const y = model.predict(x);
        const probs = Array.from(y.dataSync());
        x.dispose(); y.dispose();

        const arr = probs.map((p,i)=>({i,p})).sort((a,b)=>b.p-a.p);
        const best = arr[0];
        const top3 = arr.slice(0,3).map(o => `${o.i}:${(o.p*100).toFixed(1)}%`).join('  ');
        setOut(String(best.i), `–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(best.p*100).toFixed(1)}%`, top3);
        setStatus('–≥–æ—Ç–æ–≤–æ ‚úÖ –µ—Å–ª–∏ –æ—à–∏–±–ª–∞—Å—å ‚Äî –Ω–∞–∂–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–∏—Ñ—Ä—É');
      } catch(e){
        setStatus('–û—à–∏–±–∫–∞ —É–≥–∞–¥—ã–≤–∞–Ω–∏—è: ' + (e?.message || e));
      }
    }

    btnGuess.addEventListener('click', predict);

    // ================== training (your influence) ==================
    async function trainOnAllDataQuick(){
      // –æ–±—É—á–∞–µ–º—Å—è –Ω–∞ –í–°–ï–• —Ç–≤–æ–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –Ω–µ–º–Ω–æ–≥–æ (—á—Ç–æ–±—ã –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ)
      if(samples.length < 2) return;

      // —Å–æ–±–µ—Ä—ë–º –±–∞—Ç—á
      const xs = tf.tidy(() => {
        const list = samples.map(s => tf.tensor1d(Array.from(s.px), 'float32').div(255.0).reshape([28,28,1]));
        return tf.stack(list); // [N,28,28,1]
      });

      const ys = tf.tidy(() => {
        const labels = samples.map(s => s.y);
        const oh = tf.oneHot(tf.tensor1d(labels, 'int32'), 10);
        return oh; // [N,10]
      });

      try {
        const epochs = Math.min(8, Math.max(2, Math.floor(samples.length / 15))); // —Ä–∞—Å—Ç—ë—Ç —á—É—Ç—å-—á—É—Ç—å
        const batchSize = Math.min(32, Math.max(8, samples.length));
        await model.fit(xs, ys, {
          epochs,
          batchSize,
          shuffle: true,
          verbose: 0,
        });
      } finally {
        xs.dispose();
        ys.dispose();
      }
    }

    async function addExampleAndTrain(labelDigit){
      try {
        setStatus(`–¥–æ–±–∞–≤–ª—è—é –ø—Ä–∏–º–µ—Ä: —ç—Ç–æ ${labelDigit}‚Ä¶`);

        const u8 = canvasTo28x28Uint8();
        const sum = u8.reduce((a,b)=>a+b,0);
        if (sum < 20){
          setStatus('—Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Ä–∏—Å—É–π —Ü–∏—Ñ—Ä—É üôÇ');
          return;
        }

        samples.push({ px: u8, y: labelDigit });
        stats();

        // –æ–±—É—á–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ
        setStatus('–æ–±—É—á–∞—é –Ω–∞ —Ç–≤–æ–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö‚Ä¶');
        await trainOnAllDataQuick();

        setStatus(`–≥–æ—Ç–æ–≤–æ ‚úÖ —Ç–µ–ø–µ—Ä—å —è —á—É—Ç—å –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—é —Ç–≤–æ—é —Ü–∏—Ñ—Ä—É ${labelDigit}`);
      } catch(e) {
        setStatus('–û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è: ' + (e?.message || e));
      }
    }

    // ================== label buttons (0..9) ==================
    const grid = $('labelGrid');
    for (let i=0;i<=9;i++){
      const b = document.createElement('button');
      b.className = 'small';
      b.textContent = String(i);
      b.addEventListener('click', () => addExampleAndTrain(i));
      grid.appendChild(b);
    }

    // ================== Save / Load (model + samples) ==================
    const LS_KEY = 'digit_samples_v1';
    const MODEL_KEY = 'indexeddb://digit-personal-model';

    async function saveAll(){
      try{
        if(!model || samples.length === 0) return;

        setStatus('—Å–æ—Ö—Ä–∞–Ω—è—é –º–æ–¥–µ–ª—å‚Ä¶');
        await model.save(MODEL_KEY);

        setStatus('—Å–æ—Ö—Ä–∞–Ω—è—é —Ç–≤–æ–∏ –ø—Ä–∏–º–µ—Ä—ã‚Ä¶');
        const payload = samples.map(s => ({ y: s.y, px: u8ToB64(s.px) }));
        localStorage.setItem(LS_KEY, JSON.stringify(payload));

        setStatus('—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ');
      } catch(e){
        setStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (e?.message || e));
      }
    }

    async function loadAll(){
      try{
        setStatus('–∑–∞–≥—Ä—É–∂–∞—é –º–æ–¥–µ–ª—å‚Ä¶');
        model = await tf.loadLayersModel(MODEL_KEY);
        model = compileModel(model); // –≤–∞–∂–Ω–æ –ø–æ—Å–ª–µ load
        setStatus('–º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ ‚úÖ');

        setStatus('–∑–∞–≥—Ä—É–∂–∞—é –ø—Ä–∏–º–µ—Ä—ã‚Ä¶');
        const raw = localStorage.getItem(LS_KEY);
        if(raw){
          const arr = JSON.parse(raw);
          samples = arr.map(o => ({ y: o.y, px: b64ToU8(o.px) }));
        } else {
          samples = [];
        }
        stats();

        setStatus(samples.length ? '–≥–æ—Ç–æ–≤–æ ‚úÖ –∑–∞–≥—Ä—É–∂–µ–Ω–æ' : '–º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–µ—Ç (–Ω–∞—á–Ω–∏ –æ–±—É—á–∞—Ç—å –∫–Ω–æ–ø–∫–∞–º–∏ 0‚Äì9)');
      } catch(e){
        setStatus('–ù–µ—á–µ–≥–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å: —Å–Ω–∞—á–∞–ª–∞ –æ–±—É—á–∏, –ø–æ—Ç–æ–º ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª');
      }
    }

    function resetAll(){
      if(!confirm('–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –º–æ–¥–µ–ª—å –∏ –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã?')) return;
      samples = [];
      localStorage.removeItem(LS_KEY);
      // —É–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å –∏–∑ indexeddb
      (async () => {
        try {
          await tf.io.removeModel(MODEL_KEY);
        } catch(_) {}
        model = buildModel();
        stats();
        clearCanvas();
        setStatus('—Å–±—Ä–æ—à–µ–Ω–æ ‚úÖ –Ω–∞—á–Ω–∏ –æ–±—É—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ (–∫–Ω–æ–ø–∫–∏ 0‚Äì9)');
      })();
    }

    btnSave.addEventListener('click', saveAll);
    btnLoad.addEventListener('click', loadAll);
    btnReset.addEventListener('click', resetAll);

    // ================== init ==================
    (async () => {
      model = buildModel();
      stats();
      setStatus('–≥–æ—Ç–æ–≤–æ ‚úÖ –Ω–∞—Ä–∏—Å—É–π —Ü–∏—Ñ—Ä—É, –Ω–∞–∂–º–∏ ¬´–£–≥–∞–¥–∞—Ç—å¬ª, –∏ –µ—Å–ª–∏ –æ—à–∏–±—Å—è ‚Äî –Ω–∞–∂–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–∏—Ñ—Ä—É 0‚Äì9');
    })();
  </script>
</body>
</html>
